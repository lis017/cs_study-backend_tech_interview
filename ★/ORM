객체그래프란?
Java
코드 복사
Holiday → Country
이런 객체 참조 구조 전체를 말합니다.
DB는 FK, Java는 객체 참조
이 둘을 맞춰주는 게 JPA입니다.

객체 그래프 관리
->JPA는 엔티티 간 참조관계를 추적하고 상태 변화를 감지하여 DB와 객체 구조를 일관되게 유지합니다.
-> jpa는 알아서 해준다.
연관관계 자동 관리
지연로딩(Lazy)
cascade 전파
영속성 컨텍스트에서 관계 추적
1차캐시
flush 시점

각각 심화
->1차캐시: 항상 같은 객체 참조 보장.
영속성컨텍스트 내에선 캐시형태map에 저장해두기에. 2회차부턴 db조회없이 여기서 꺼내씀
① 연관관계 자동 관리
Java
코드 복사
holiday.setCountry(country);
이러면
FK 값 변경 추적
flush 시 update SQL 생성
👉 객체 참조 변경을 감지해서 DB FK 변경
이걸 "관계 추적"이라고 합니다.
② Lazy 로딩
Java
코드 복사
holiday.getCountry();
그 전까지 DB 조회 안 함.
👉 객체그래프 일부만 필요할 때만 로딩
그래프를 부분적으로 관리
③ Cascade 전파
Java
코드 복사
cascade = CascadeType.PERSIST
holiday 저장하면 country도 같이 저장
👉 그래프 단위 저장
④ 영속성 컨텍스트 관계 추적
엔티티 상태 변하면:
어떤 엔티티가 변경됐는지 기억
flush 시점에 SQL 자동 생성
이게 더티체킹입니다.
⑤ 1차 캐시
그래프 내 동일 객체 참조 보장
같은 country를 여러 holiday가 참조해도
한 트랜잭션 내에서는 동일 객체
bulk연산시 불일치 주의
⑥ flush 시점
트랜잭션 commit 직전
변경된 객체들 전부 SQL로 변환
그래프 전체를 DB에 동기화

왜 장점인가
->객체처럼 쓸수있게 getcode()이런거 쓰면
fk에 select알아서 해서 갖다준다.